# Database 트랜잭션

## 트랜잭션 개념

### 정의

- 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위
- 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미

## 트랜잭션 특성(ACID)

### ****Atomicity(원자성)****

- 트랜잭션의 연산들은 데이터베이스에 모두 반영되거나 전혀 반영되지 않아야 함(all or nothing)
- 트랜잭션 수행과정에서 오류가 발생하여 작업이 완료되지 못하면 트랜잭션 시작 전 상태로 데이터베이스를 되돌려야 함

### ****Consistency(일관성)****

- 트랜잭션이 성공적으로 수행된 후에도 데이터베이스가 일관성 있는 상태를 유지해야 함
- 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 함
- 데이터베이스의 제약조건을 위배하는 작업을 트랜잭션 과정에서 수행할 수 없음을 나타냄

### ****Isolation(격리성)****

- 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없음
- 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없음
- 예) A->B로 송금 과정에서 다른 트랜잭션이 B에게로 송금할 수 없음

### ****Durablility(지속성)****

- 트랜잭션이 성공적으로 완료된 이후 데이터베이스에 반영한 수행 결과는 손실되지 않고 영구적으로 유지되어야 함

<aside>
💡 ACID는 **이론적으로** 트랜잭션이 보장해야할 특성.
실제로는 모든 규칙을 지킬 경우 성능상 속도 저하가 생길 수 있어 트랜잭션 격리 수준을 조정합니다.

</aside>

## ****트랜잭션 연산****

### Commit

- 트랜잭션이 성공적으로 수행되었음을 선언하는 연산
- commit 연산의 실행을 통해 트랜잭션의 수행이 성공적으로 완료되었음을 선언하고 결과를 최종 데이터베이스에 반영.

### ****Rollback****

- 트랜잭션이 수행을 실패했음을 선언하고 작업을 취소하는 연산
- 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 연산
- Rollback시에는 해당 트랜잭션을 재시작하거나 폐기한다.

## 트랜잭션 상태
![Untitled (2)](https://user-images.githubusercontent.com/90780701/173233497-3f37a293-e23a-4a68-b9cd-60c5c2ec3d96.png)

### 활성 상태

- 트랜잭션이 수행을 시작하여 현재 수행 중인 상태.

### 부분 완료 상태

- 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태

### 완료 상태

- 트랜잭션이 성공적으로 완료되어 commit 연산을 실행한 완료 상태.

### 실패 상태

- 장애가 발생하여 트랜잭션의 수행이 중단된 상태.

### 철회 상태

- 수행이 실패하여 rollback 연산을 실행한 상태.
